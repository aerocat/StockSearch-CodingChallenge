const express = require('express');
const cors = require('cors');
const procedures = require('./procedures.js');

var app = express();
const port = 3000;
app.use(cors());

app.get('/api/companies', function(req, res) {
  return procedures.getListOfCompanies(res);
});

app.get('/api/:ticker', function(req, res) {
  let ticker = req.params.ticker;
  // console.log(ticker);
  // let yo = [{"date":"2019-02-15","open":171.25,"high":171.7,"low":169.75,"close":170.42,"volume":24626814,"unadjustedVolume":24626814,"change":-0.38,"changePercent":-0.222,"vwap":170.4848,"label":"Feb 15","changeOverTime":0},{"date":"2019-02-19","open":169.71,"high":171.44,"low":169.49,"close":170.93,"volume":18972826,"unadjustedVolume":18972826,"change":0.51,"changePercent":0.299,"vwap":170.52,"label":"Feb 19","changeOverTime":0.0029926065015844347},{"date":"2019-02-20","open":171.19,"high":173.32,"low":170.99,"close":172.03,"volume":26114362,"unadjustedVolume":26114362,"change":1.1,"changePercent":0.644,"vwap":172.2129,"label":"Feb 20","changeOverTime":0.0094472479755898},{"date":"2019-02-21","open":171.8,"high":172.37,"low":170.3,"close":171.06,"volume":17249670,"unadjustedVolume":17249670,"change":-0.97,"changePercent":-0.564,"vwap":171.116,"label":"Feb 21","changeOverTime":0.003755427766694137},{"date":"2019-02-22","open":171.58,"high":173,"low":171.38,"close":172.97,"volume":18913154,"unadjustedVolume":18913154,"change":1.91,"changePercent":1.117,"vwap":172.3528,"label":"Feb 22","changeOverTime":0.014963032507921673},{"date":"2019-02-25","open":174.16,"high":175.87,"low":173.95,"close":174.23,"volume":21873358,"unadjustedVolume":21873358,"change":1.26,"changePercent":0.728,"vwap":174.8641,"label":"Feb 25","changeOverTime":0.022356530923600532},{"date":"2019-02-26","open":173.71,"high":175.3,"low":173.1732,"close":174.33,"volume":17070211,"unadjustedVolume":17070211,"change":0.1,"changePercent":0.057,"vwap":174.3702,"label":"Feb 26","changeOverTime":0.02294331651214661},{"date":"2019-02-27","open":173.21,"high":175,"low":172.73,"close":174.87,"volume":27835389,"unadjustedVolume":27835389,"change":0.54,"changePercent":0.31,"vwap":174.1866,"label":"Feb 27","changeOverTime":0.02611195869029467},{"date":"2019-02-28","open":174.32,"high":174.91,"low":172.92,"close":173.15,"volume":28215416,"unadjustedVolume":28215416,"change":-1.72,"changePercent":-0.984,"vwap":173.7766,"label":"Feb 28","changeOverTime":0.016019246567304416},{"date":"2019-03-01","open":174.28,"high":175.15,"low":172.89,"close":174.97,"volume":25886167,"unadjustedVolume":25886167,"change":1.82,"changePercent":1.051,"vwap":174.2926,"label":"Mar 1","changeOverTime":0.02669874427884058},{"date":"2019-03-04","open":175.69,"high":177.75,"low":173.97,"close":175.85,"volume":27436203,"unadjustedVolume":27436203,"change":0.88,"changePercent":0.503,"vwap":175.9435,"label":"Mar 4","changeOverTime":0.03186245745804487},{"date":"2019-03-05","open":175.94,"high":176,"low":174.54,"close":175.53,"volume":19737419,"unadjustedVolume":19737419,"change":-0.32,"changePercent":-0.182,"vwap":175.36,"label":"Mar 5","changeOverTime":0.029984743574697888},{"date":"2019-03-06","open":174.67,"high":175.49,"low":173.94,"close":174.52,"volume":20810384,"unadjustedVolume":20810384,"change":-1.01,"changePercent":-0.575,"vwap":174.743,"label":"Mar 6","changeOverTime":0.02405820913038389},{"date":"2019-03-07","open":173.87,"high":174.44,"low":172.02,"close":172.5,"volume":24796374,"unadjustedVolume":24796374,"change":-2.02,"changePercent":-1.157,"vwap":173.0614,"label":"Mar 7","changeOverTime":0.012205140241755737},{"date":"2019-03-08","open":170.32,"high":173.07,"low":169.5,"close":172.91,"volume":23999358,"unadjustedVolume":23999358,"change":0.41,"changePercent":0.238,"vwap":171.8064,"label":"Mar 8","changeOverTime":0.014610961154794093},{"date":"2019-03-11","open":175.49,"high":179.12,"low":175.35,"close":178.9,"volume":32011034,"unadjustedVolume":32011034,"change":5.99,"changePercent":3.464,"vwap":178.1174,"label":"Mar 11","changeOverTime":0.04975941790869627},{"date":"2019-03-12","open":180,"high":182.67,"low":179.37,"close":180.91,"volume":32467584,"unadjustedVolume":32467584,"change":2.01,"changePercent":1.124,"vwap":181.1313,"label":"Mar 12","changeOverTime":0.06155380823846972},{"date":"2019-03-13","open":182.25,"high":183.3,"low":180.92,"close":181.71,"volume":31032524,"unadjustedVolume":31032524,"change":0.8,"changePercent":0.442,"vwap":181.966,"label":"Mar 13","changeOverTime":0.06624809294683735},{"date":"2019-03-14","open":183.9,"high":184.1,"low":182.56,"close":183.73,"volume":23579508,"unadjustedVolume":23579508,"change":2.02,"changePercent":1.112,"vwap":183.5343,"label":"Mar 14","changeOverTime":0.07810116183546534},{"date":"2019-03-15","open":184.85,"high":187.33,"low":183.74,"close":186.12,"volume":39042912,"unadjustedVolume":39042912,"change":2.39,"changePercent":1.301,"vwap":185.7968,"label":"Mar 15","changeOverTime":0.09212533740171353},{"date":"2019-03-18","open":185.8,"high":188.39,"low":185.79,"close":188.02,"volume":26219832,"unadjustedVolume":26219832,"change":1.9,"changePercent":1.021,"vwap":187.6386,"label":"Mar 18","changeOverTime":0.10327426358408652},{"date":"2019-03-19","open":188.35,"high":188.99,"low":185.92,"close":186.53,"volume":31646369,"unadjustedVolume":31646369,"change":-1.49,"changePercent":-0.792,"vwap":187.3795,"label":"Mar 19","changeOverTime":0.09453115831475188},{"date":"2019-03-20","open":186.23,"high":189.49,"low":184.73,"close":188.16,"volume":31035231,"unadjustedVolume":31035231,"change":1.63,"changePercent":0.874,"vwap":187.4231,"label":"Mar 20","changeOverTime":0.10409576340805075},{"date":"2019-03-21","open":190.02,"high":196.33,"low":189.81,"close":195.09,"volume":51034237,"unadjustedVolume":51034237,"change":6.93,"changePercent":3.683,"vwap":194.3327,"label":"Mar 21","changeOverTime":0.14476000469428482},{"date":"2019-03-22","open":195.34,"high":197.69,"low":190.78,"close":191.05,"volume":42407666,"unadjustedVolume":42407666,"change":-4.04,"changePercent":-2.071,"vwap":193.9065,"label":"Mar 22","changeOverTime":0.12105386691702867}];
  // res.send(yo);
  return procedures.getStockData(ticker, res);
  
});

app.listen(port, function() {
  console.log(`Listening on port ${port}`);
});